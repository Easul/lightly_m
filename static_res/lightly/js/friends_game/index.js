layui.use(["jquery","layer","form","laypage"],function(){function getTestQuestion(){form.on("submit(getQuestion)",function(){var subjectId=$(".subject").val();testSubject=subjectId,$.ajax({type:"GET",url:"/plugin/QuestionOperation/GetPackageQuestion.php",data:"type=1&language="+subjectId,dataType:"json",success:function(data){$(".select-content").css("display","none"),$(".class-content").css("display","block");var result=eval(data);if(1==Number(result.status)){var questionData=data.data;styleBuild(questionData),recordAnswer(),overTest()}}})})}function styleBuild(l){addQuestion(l.select,l.select[0].length,"questionContent"),addQuestion(l.judge,l.judge[0].length,"questionContent"),showLaypage("questionPage",l.select.length+l.judge.length)}function showLaypage(l,e){var t=["prev","next","count"];laypage.render({elem:l,count:e,limit:1,groups:10,prev:"上一题",next:"下一题",first:"首页",last:"尾页",layout:t,theme:"#ff5500",jump:function(l,e){var t=l.elem.split("P")[0],a=l.curr,i=t+"Content"+(a-1);switch(t){case"question":var s=layui.data("lightly").questionContent;$("#"+s).css("display","none"),$("#"+i).css("display","block")}layui.data("lightly",{key:t+"Content",value:i})}})}function addQuestion(l,e,t){domStr=7==e?selectDom(l,t):judgeDom(l,t),$("#"+t).append(domStr),layui.data("lightly",{key:t,value:t+"0"}),form.render()}function selectDom(l,e){for(var t="",a=0;a<l.length;a++)t+='<div class="single-question" id="'+e+a+'"><div class="layui-row"><div class="layui-col-md8 layui-col-lg8 layui-col-sm8 layui-col-xs12"><div class="layui-row"><div class="layui-col-md1 layui-col-lg1 layui-col-sm1 layui-col-xs1 question-index">'+(a+1)+'</div><div class="layui-col-md11 layui-col-lg11 layui-col-sm11 layui-col-xs11">'+l[a][1]+'</div></div><div class="layui-row answer-box"><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><div><input class="layui-col-md1 layui-col-lg1 layui-col-sm1 layui-col-xs1" type="radio" name="select" value="A" title="A" myId="'+e+'" myNumber="'+a+'" lay-filter="judgeResult"></div><div class="layui-col-md10 layui-col-lg10 layui-col-sm10 layui-col-xs10 left-space">'+l[a][2]+'</div></div><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><div><input type="radio" name="select" value="B" title="B" myId="'+e+'" myNumber="'+a+'" lay-filter="judgeResult"></div><div class="layui-col-md10 layui-col-lg10 layui-col-sm10 layui-col-xs10  left-space">'+l[a][3]+'</div></div><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><div><input type="radio" name="select" value="C" title="C" myId="'+e+'" myNumber="'+a+'" lay-filter="judgeResult"></div><div class="layui-col-md10 layui-col-lg10 layui-col-sm10 layui-col-xs10  left-space">'+l[a][4]+'</div></div><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><div><input type="radio" name="select" value="D" title="D" myId="'+e+'" myNumber="'+a+'" lay-filter="judgeResult"></div><div class="layui-col-md10 layui-col-lg10 layui-col-sm10 layui-col-xs10  left-space">'+l[a][5]+"</div></div></div></div></div></div>";return t}function judgeDom(l,e){for(var t="",a=0;a<l.length;a++)t+='<div class="single-question" id="'+e+(a+l.length)+'"><div class="layui-row"><div class="layui-col-md8 layui-col-lg8  layui-col-sm8 layui-col-xs12"><div class="layui-row"><div class="layui-col-md1 layui-col-lg1 layui-col-sm1 layui-col-xs1 question-index">'+(a+1+l.length)+'</div><div class="layui-col-md11 layui-col-lg11 layui-col-sm11 layui-col-xs11">'+l[a][1]+'</div></div><div class="layui-row answer-box"><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><input type="radio" name="judge" value="对" title="对" myId="'+e+'" myNumber="'+(a+l.length)+'" lay-filter="judgeResult"></div><div class="layui-col-md11 layui-col-lg11 layui-col-md-offset1 layui-col-lg-offset1 layui-col-sm11 layui-col-xs11 layui-col-sm-offset1 layui-col-xs-offset1"><input type="radio" name="judge" value="错" title="错" myId="'+e+'" myNumber="'+(a+l.length)+'" lay-filter="judgeResult"></div></div></div></div></div>';return t}function recordAnswer(){form.on("radio(judgeResult)",function(l){var e=l.value,t=$(this).attr("mynumber");allAnswer[t]=e})}function overTest(){$(".over-test").click(function(){if(-1!=allAnswer.indexOf(""))layer.msg("请完成所有问题的作答");else{var testLoad=layer.load(3);$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=7&user="+user+"&answer="+JSON.stringify(allAnswer)+"&subject="+testSubject,dataType:"json",success:function(data){layer.close(testLoad);var result=eval(data),showContent="";1==Number(result.status)?showContent='<p style="text-align:center;">真棒,你全都作对了哦,获得若轻分10分</p>':2==Number(result.status)?showContent="真难过,你的测试成绩太低了,扣除若轻分10分":3==Number(result.status)&&(showContent="您的成绩居中,继续努力哦"),layer.open({content:showContent,btn:["再来一轮"],btnAlign:"c",yes:function(){$(location).attr("href","/res/friends_game/")},cancel:function(){$(location).attr("href","/main.html")}})}})}})}var $=layui.$,layer=layui.layer,form=layui.form,laypage=layui.laypage,user=layui.data("lightly").user,windowState=!0,ajaxIndex=0,allAnswer=["","","","","","","","","",""],testSubject="",allPageLoad=layer.open({type:3,shade:[1,"#ffffff"]});$(window).width()>991&&windowState&&(windowState=!1,layer.msg("不支持PC或较大屏幕平板打开"),setTimeout(function(){$(location).attr("href","/main.html")},500)),$(window).resize(function(){$(window).width()>991&&windowState&&(windowState=!1,layer.msg("不支持PC或较大屏幕平板打开"),setTimeout(function(){$(location).attr("href","/main.html")},500))}),null==user&&(layer.msg("未登陆"),$(function(){setTimeout(function(){$(location).attr("href","/login.html")},300)})),$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=10&user="+user,dataType:"json",success:function(data){var result=eval(data);if(1==Number(result.status)){for(var dom="",i=0;i<result.data.length;i++)dom+='<option value="'+result.data[i].subjectId+'">'+result.data[i].subjectName+"</option>";$(".select-content select").append(dom),dom='<p style="text-align:center;padding:40px 0;"><button class="layui-btn layui-btn-normal  layui-btn-lg" lay-submit lay-filter="getQuestion">点击测试</button></p>',$(".select-content").append(dom),form.render("select"),getTestQuestion(),0==ajaxIndex?(layer.close(allPageLoad),$(".self-test").css("display","block"),$(".phone-nav").css("display","block")):ajaxIndex++}else 2==Number(result.status)&&layer.open({content:'<p style="text-align:center;">没有课程,是否添加新课程</p>',btn:["添加"],btnAlign:"c",yes:function(){$(location).attr("href","/res/study_package/")},cancel:function(){$(location).attr("href","/main.html")}})}})});