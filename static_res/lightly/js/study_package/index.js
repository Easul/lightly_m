layui.use(["layer","jquery","layim","element"],function(){function createLayim(ws,$,layim,layer,user,userStatus,showInputState){ws.onopen=function(){userInfo={infoType:1,user:""+user},ws.send(JSON.stringify(userInfo))},layim.config({title:"若轻一下",initSkin:"2.jpg",notice:!0,voice:"audio_1.mp3",init:{url:"/plugin/Chat/tools/GetUserInfo.php",type:"get",data:{user:""+user}},members:{url:"/plugin/Chat/tools/GetGroupInfo.php",data:{}},tool:[{alias:"code",title:"代码",icon:"&#xe64e;"}],msgbox:"/res/chat/tools/msgbox.html?v=2",find:"/res/chat/tools/find.html?v=1"}),layim.on("tool(code)",function(a,e,t){layer.prompt({title:"插入代码",formType:2,shade:0},function(t,s){layer.close(s),a("[pre class=layui-code]"+t+"[/pre]"),e()})}),layim.on("ready",function(options){userStatus=options.mine.status,$.ajax({type:"GET",url:"/plugin/Chat/tools/NewFriendsInfo.php",data:"type=0&user="+user,dataType:"json",success:function(res){var result=eval(res);if(1==Number(result.status)&&0!=Number(result.data)){var newMessageTips=$(".layim-tool-msgbox").find("span");newJoin=Number(result.data),newMessageTips.html(newJoin),newMessageTips.addClass("layui-anim-fadein layui-anim-loop"),newMessageTips.css("display","block")}}}),$(".layim-tool-msgbox").click(function(){$(".layim-tool-msgbox").find("span").css("display","none")})}),layim.on("online",function(a){userStatus!=a&&(userStatus=a,userStatusInfo={infoType:3,userStatus:""+a,user:""+user},ws.send(JSON.stringify(userStatusInfo)))}),layim.on("sign",function(a){$.ajax({type:"GET",url:"/plugin/Chat/tools/ChangeUserInfo.php",data:"user="+user+"&type=1&sign="+encodeURIComponent(a)})}),layim.on("chatChange",function(a){var e=a.data.type,t=a.data.id;"friend"===e&&(layim.setChatStatus('<span id="'+t+'InputStatus" style="color:#FF5722;display:none;">对方正在输入。。</span>'),$(".layim-chat-textarea textarea").bind("input propertychange",function(){$(this).val()?inputStatus=1:inputStatus=0,userInputInfo={infoType:4,inputStatus:inputStatus,to:""+t,from:""+user},ws.send(JSON.stringify(userInputInfo))}))}),layim.on("sendMessage",function(a){var e=a.mine,t=a.to;if("friend"==t.type||"group"==t.type){var s={infoType:2,to:""+t.id,from:""+e.id,message:""+e.content,username:""+e.username,avatar:""+e.avatar,type:""+t.type};ws.send(JSON.stringify(s))}}),ws.onmessage=function(res){var res=eval("("+res.data+")");switch(res.state){case 0:break;case 1:layim.on("ready",function(a){for(var e=0;e<res.data.length;e++)layim.getMessage(res.data[e])});break;case 2:layim.getMessage(res.data);break;case 3:"online"==res.data.type?type="online":type="offline",layim.setFriendStatus(res.data.id,type);break;case 4:var inputStatus=res.data.inputStatus,from=res.data.from;"1"==inputStatus?($("#"+from+"InputStatus").css("display","block"),showInputState&&(showInputState=!1,setTimeout(function(){$("#"+from+"InputStatus").css("display","none"),showInputState=!0},5e3))):$("#"+from+"InputStatus").css("display","none");break;case 5:case 6:case 7:newJoin++;var newMessageTips=$(".layim-tool-msgbox").find("span");newMessageTips.html(newJoin),newMessageTips.addClass("layui-anim-fadein layui-anim-loop"),newMessageTips.css("display","block");break;case 8:case 9:layim.addList(res.data);break;case 10:$(".layim-friend"+res.data.userTable).remove()}}}function packageDom(a,e,t){var s="";if(e)var n='style="display:block;"';else n='style="display:none;"';for(var i=0;i<a.length;i++){var l=a[i].studyState?"layui-btn-disabled":"",o=a[i].studyState?"已购买该课程":"学习该课程";switch(Number(a[i].tot)){case 0:var u='totState="0"',r='totState="0"';break;case 1:u='style="color:#FF5722;" totState="1"',r='totState="1"';break;case 2:u='totState="2"',r='style="color:#FF5722;" totState="2"'}s+='<div class="layui-col-md3 layui-col-lg3 layui-col-sm4 layui-col-xs6 class-button" '+n+' languageBox="'+t+'"><div class="layui-anim language-button" language="'+a[i].languageNum+'"><p><i class="layui-icon-read layui-icon"></i></p><p class="package-name">'+a[i].packageName+"</p><p>"+a[i].packageInfo+'</p><p><i class="layui-icon-praise layui-icon do-thumb" '+u+' title="赞"></i><span>'+a[i].thumb+'</span><i class="layui-icon-tread layui-icon do-tread" '+r+' title="踩"></i><span>'+a[i].tread+'</span></p><button type="button" class="layui-btn '+l+' get-class" packagePrice="'+a[i].price+'">'+o+"</button></div></div>"}return s}function packageAnim(){$(".language-button").mouseenter(function(){var a=$(this);a.addClass("layui-anim-scale"),setTimeout(function(){a.removeClass("layui-anim-scale")},500)})}function packageInit(){packageAnim(),changePackageType(),clickThumbOrTread(),getClassPackage()}function changePackageType(){$(".learning-course").click(function(){var a=$(this).attr("languageType");$("div[languageBox='"+nowPackageNum+"']").css("display","none"),$("div[languageBox='"+a+"']").css("display","block"),$.ajax({async:!1,success:function(){nowPackageNum=a}})})}function clickThumbOrTread(){function a(a,e,t,s){$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=0&packageName="+a+"&languageNumber="+e+"&totType="+t+"&user="+s})}$(".do-thumb").click(function(){if(0==Number($(this).attr("totState"))){$(this).css("color","#FF5722"),$(this).attr("totState","1"),$(this).nextAll("i").attr("totState","1");var e=Number($(this).next().html());$(this).next().html(++e),layer.msg("点赞成功 !");var t=$(this).parent().prevAll(".package-name").html(),s=$(this).parents(".language-button").attr("language");a(t,s,1,user)}}),$(".do-tread").click(function(){if(0==Number($(this).attr("totState"))){$(this).css("color","#FF5722"),$(this).attr("totState","2"),$(this).prevAll("i").attr("totState","2");var e=Number($(this).next().html());$(this).next().html(++e),layer.msg("竟然踩了 !");var t=$(this).parent().prevAll(".package-name").html(),s=$(this).parents(".language-button").attr("language");a(t,s,2,user)}})}function getClassPackage(){$(".get-class").click(function(){var buttonObj=$(this),packageName=buttonObj.prevAll(".package-name").html(),languageNumber=buttonObj.parent(".language-button").attr("language");layer.open({type:1,title:"提示",offset:"auto",content:'<div style="padding: 20px 80px;">确认要购买 <span style="color:#FFB800;">'+packageName+'</span> 吗?<br/>您需要花费 <span style="color:#FFB800;">'+buttonObj.attr("packagePrice")+"</span> 若轻分</div>",btn:"确认",btnAlign:"c",shade:0,yes:function(index){layer.close(index);var buyCourse=layer.open({type:3,shade:[.5,"#000"]});$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=1&user="+user+"&languageNumber="+languageNumber,dataType:"json",success:function(res){layer.close(buyCourse);var result=eval(res);switch(Number(result.status)){case 1:buttonObj.addClass("layui-btn-disabled"),buttonObj.html("已购买该课程"),layer.msg("购买成功,请在马上学习模块查询!",{time:5e3,icon:6});break;case 2:layer.msg("若轻分不够,请充值或与自我测试获得!",{time:5e3,icon:5})}}})}})})}var layer=layui.layer,$=layui.$,nowPackageNum=0,user=layui.data("lightly").user;null==user&&(layer.msg("未登陆"),$(function(){setTimeout(function(){$(location).attr("href","/login.html")},300)}));var layim=layui.layim,initLayim=!0,userStatus="",showInputState=!0,isPC=!0,ajaxIndex=0;newJoin=0,"none"==$(".device-type").css("display")&&(isPC=!1),$("#exit").click(function(){layer.open({type:1,title:"提示",offset:"auto",content:'<div style="padding: 20px 100px;">期待与你下次相遇!</div>',btn:"退出账户",btnAlign:"c",shade:0,yes:function(){layer.closeAll(),layui.data("lightly",null),$(location).attr("href","/login.html")}})});var allPageLoad=layer.open({type:3,shade:[1,"#ffffff"]});$(".head-image").attr("src",layui.data("lightly").userInfo.headImage),$(".nickname").html(layui.data("lightly").userInfo.nickname),$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=4&user="+user,dataType:"json",success:function(res){var result=eval(res);if(1==Number(result.status)){var programData=result.data.program,fundationData=result.data.fundation,imageData=result.data.image,gameData=result.data.game,dom=packageDom(programData,1,0)+packageDom(fundationData,0,1)+packageDom(imageData,0,2)+packageDom(gameData,0,3);$(".class-box").append(dom),packageInit(),0==ajaxIndex?(layer.close(allPageLoad),$(".layui-container").css("display","block"),$(".phone-nav").css("display","block")):ajaxIndex++}}}),isPC&&(initLayim=!1,ws=new WebSocket("ws://lightly.52ch.top:8686"),createLayim(ws,$,layim,layer,user,userStatus,showInputState)),$(window).resize(function(){isPC="none"!=$(".device-type").css("display"),isPC&&initLayim?(initLayim=!1,ws=new WebSocket("ws://lightly.52ch.top:8686"),createLayim(ws,$,layim,layer,user,userStatus,showInputState)):isPC||initLayim||(initLayim=!0,ws.close(),$(".layui-layer").remove())})});