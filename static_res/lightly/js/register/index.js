layui.use(["layer","jquery","form","util","laytpl"],function(){var e=layui.layer,o=layui.$,n=layui.form,t=layui.laytpl,s=e.open({type:3});o.ajax({type:"POST",url:"/plugin/EnterLightly/GetSchoolList.php",data:"schoolType=1",dataType:"json",success:function(a){var i=a,l='<select name="schoolName" lay-verify="schoolName"><option value=""></option>{{#  layui.each(d.list,function(index,item){ }}<option value="{{  index }}">{{  item }}</option>{{#  }); }}</select>';t(l).render(i,function(e){o("#selectBox").text(""),o("#selectBox").append(e)}),n.render("select"),e.close(s)}}),n.verify({phoneNumber:[/^[1]([3-9])[0-9]{9}$/,"手机号有误,请重新输入"],schoolNumber:[/^(20)[0-9]{10}$/,"学号输入有误,请重新输入"],schoolName:function(e){if(0==e.length)return"请选择所在学校"},pass:[/^[\S]{6,12}$/,"密码必须6到12位，且不能出现空格"],verifyCode:[/^[a-z]{4}$/,"验证码输入错误"]}),o("#phoneNumber").on("input propertychange",function(){var n=o(this).val();11==n.length&&(e.msg("查询中,请稍后 !",{shade:[.2,"#393D49"]}),o.ajax({type:"GET",url:"../../plugin/EnterLightly/RegisterCheck.php",data:"checkType=1&phoneNumber="+n,dataType:"json",success:function(n){"yes"==n.status?(e.msg("该号码已注册 !"),o("#phoneNumber").val(""),o("#phoneNumber").focus()):e.msg("可以注册 !")}}))}),o("#schoolNumber").on("input propertychange",function(){var n=o(this).val();12==n.length&&(e.msg("查询中,请稍后 !",{shade:[.2,"#393D49"]}),o.ajax({type:"GET",url:"../../plugin/EnterLightly/RegisterCheck.php",data:"checkType=2&schoolNumber="+n,dataType:"json",success:function(n){"yes"==n.status?(e.msg("该学号已注册 !"),o("#schoolNumber").val(""),o("#schoolNumber").focus()):e.msg("可以注册 !")}}))}),o("#verifyCode").click(function(){o("#verifyCode").attr("src","../../plugin/VerifyCode/GetVerify.php?random="+1e5*Math.random())}),o("#verifyBox").on("input propertychange",function(){4==o(this).val().length&&(e.msg("查询中,请稍后 !",{shade:[.2,"#393D49"]}),o.ajax({type:"GET",url:"../../plugin/EnterLightly/VerifyCheck.php",data:"vetifyCode="+o(this).val(),dataType:"json",success:function(n){"yes"==n.status?e.msg("验证码正确,请继续注册 !"):(e.msg("验证码错误,请重新填写 !"),o("#verifyBox").val(""),o("#verifyBox").focus())}}))}),n.on("submit(register)",function(n){e.closeAll();var t=e.open({type:3}),s=n.field.phoneNumber,a=n.field.schoolNumber,i=n.field.password,l=n.field.nickname,r=n.field.sex,c=n.field.schoolName,u=n.field.verifyCode;return console.log("phoneNumber="+s+"&schoolNumber="+a+"&password="+encodeURIComponent(i)+"&nickname="+encodeURIComponent(l)+"&sex="+r+"&schoolName="+c+"&verifyCode="+u),o.ajax({type:"POST",url:"/plugin/EnterLightly/Register.php",data:"phoneNumber="+s+"&schoolNumber="+a+"&password="+encodeURIComponent(i)+"&nickname="+encodeURIComponent(l)+"&sex="+r+"&schoolName="+c+"&verifyCode="+u,dataType:"json",success:function(n){e.close(t),"yes"==n.status?(e.msg("注册成功！"),o(function(){setTimeout(function(){o(location).attr("href","/login.html")},2e3)})):e.msg("注册失败!")}}),!1})});