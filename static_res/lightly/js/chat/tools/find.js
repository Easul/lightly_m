layui.use(["layim","jquery","form"],function(){var layim=layui.layim,form=layui.form,$=layui.jquery,user=layui.data("lightly").user,friendArr="",groupArr="",ws=new WebSocket("ws://lightly.52ch.top:8686");form.verify({lightlyNumber:[/^[\d]{12}$/,"账号必须为12位"]}),form.on("submit(search)",function(){var searchType=$("#lightlyNumber").attr("user"),lightlyNumber=$("#lightlyNumber").val(),myload=layer.load(3);$.ajax({type:"GET",url:"/plugin/Chat/tools/SearchUserInfo.php",data:"searchType="+searchType+"&lightlyNumber="+lightlyNumber+"&user="+user,dataType:"json",success:function(data){var result=eval(data);if(Number(searchType))switch(Number(result.status)){case 0:layer.close(myload),layer.msg("传入错误的参数!");break;case 1:groupArr=result.data,$(".group-box").css("display","block"),$(".user-box").css("display","none"),$(".group-head").attr("src",result.data.groupHead),$(".group-name").html(result.data.nickname),$(".group-number").html("("+lightlyNumber+")"),$(".member-num").html(result.data.memberNum),$("span[user='1']").attr("mysearch","1"),layer.close(myload);break;case 2:layer.close(myload),layer.msg("没有该群号!");break;case 4:layer.close(myload),layer.msg("已经加过该群!")}else switch(Number(result.status)){case 0:layer.close(myload),layer.msg("传入错误的参数!");break;case 1:friendArr=result.data,$(".user-box").css("display","block"),$(".group-box").css("display","none"),$(".user-head").attr("src",result.data.userHead),$(".user-name").html(result.data.nickname),$(".user-number").html("("+lightlyNumber+")"),Number(result.data.sex)?($(".sex").removeClass("layui-icon-male"),$(".sex").addClass("layui-icon-female"),$(".sex").css("color","#EDC0C2")):($(".sex").removeClass("layui-icon-female"),$(".sex").addClass("layui-icon-male"),$(".sex").css("color","#529DD2")),$("span[user='0']").attr("mysearch","1"),layer.close(myload);break;case 2:layer.close(myload),layer.msg("没有该人账号!");break;case 3:layer.close(myload),layer.msg("不允许添加自己为好友!");break;case 4:layer.close(myload),layer.msg("已经加过该好友!")}}})}),$(".search-type").click(function(){$(".search-type").css("color","black"),$(this).css("color","#1E9FFF");var e=$(this).attr("user");Number(e)?($("#lightlyNumber").attr("placeholder","请输入若轻群号"),Number($(this).attr("mysearch"))?($(".group-box").css("display","block"),$(".user-box").css("display","none")):($(".group-box").css("display","none"),$(".user-box").css("display","none"))):($("#lightlyNumber").attr("placeholder","请输入若轻号"),Number($(this).attr("mysearch"))?($(".user-box").css("display","block"),$(".group-box").css("display","none")):($(".group-box").css("display","none"),$(".user-box").css("display","none"))),$("#lightlyNumber").attr("user",e)}),$("#friendButton").click(function(){layim.add({type:"friend",username:friendArr.nickname,avatar:friendArr.userHead,submit:function(e,r,a){var s={infoType:5,type:0,friendName:""+friendArr.nickname,friendId:""+friendArr.userTable,mineId:""+user,remark:r};ws.send(JSON.stringify(s)),layer.close(a)}})}),$("#groupButton").click(function(){layim.add({type:"group",username:groupArr.nickname,avatar:groupArr.groupHead,submit:function(e,r,a){var s={infoType:5,type:1,groupName:""+groupArr.nickname,groupId:""+groupArr.groupTable,mineId:""+user,remark:r};ws.send(JSON.stringify(s)),layer.close(a)}})})});