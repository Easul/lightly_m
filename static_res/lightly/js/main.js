layui.use(["jquery","table","util","form","element","layim","layer"],function(){function changePageState(e,a){$(".layer-footer").find("i").css("color","black"),a.children("i").css("color","#FF5722"),$("#courseMainPage").addClass("layui-hide-sm"),$("#courseMainPage").removeClass("layui-show-sm-block"),$("#courseMainPage").addClass("layui-hide-xs"),$("#courseMainPage").removeClass("layui-show-xs-block"),$("#homeMainPage").addClass("layui-hide-sm"),$("#homeMainPage").removeClass("layui-show-sm-block"),$("#homeMainPage").addClass("layui-hide-xs"),$("#homeMainPage").removeClass("layui-show-xs-block"),$("#systemMainPage").addClass("layui-hide-sm"),$("#systemMainPage").removeClass("layui-show-sm-block"),$("#systemMainPage").addClass("layui-hide-xs"),$("#systemMainPage").removeClass("layui-show-xs-block"),$("#"+e).addClass("layui-show-sm-block"),$("#"+e).removeClass("layui-hide-sm"),$("#"+e).addClass("layui-show-xs-block"),$("#"+e).removeClass("layui-hide-xs")}function createLayim(ws,$,layim,layer,user,userStatus,showInputState){ws.onopen=function(){userInfo={infoType:1,user:""+user},ws.send(JSON.stringify(userInfo))},layim.config({title:"若轻一下",initSkin:"2.jpg",notice:!0,voice:"audio_1.mp3",init:{url:"/plugin/Chat/tools/GetUserInfo.php",type:"get",data:{user:""+user}},members:{url:"/plugin/Chat/tools/GetGroupInfo.php",data:{}},tool:[{alias:"code",title:"代码",icon:"&#xe64e;"}],msgbox:"/res/chat/tools/msgbox.html?v=2",find:"/res/chat/tools/find.html?v=2"}),layim.on("tool(code)",function(e,a,t){layer.prompt({title:"插入代码",formType:2,shade:0},function(t,s){layer.close(s),e("[pre class=layui-code]"+t+"[/pre]"),a()})}),layim.on("ready",function(options){userStatus=options.mine.status,$.ajax({type:"GET",url:"/plugin/Chat/tools/NewFriendsInfo.php",data:"type=0&user="+user,dataType:"json",success:function(res){var result=eval(res);if(1==Number(result.status)&&0!=Number(result.data)){var newMessageTips=$(".layim-tool-msgbox").find("span");newJoin=Number(result.data),newMessageTips.html(newJoin),newMessageTips.addClass("layui-anim-fadein layui-anim-loop"),newMessageTips.css("display","block")}}}),$(".layim-tool-msgbox").click(function(){$(".layim-tool-msgbox").find("span").css("display","none")})}),layim.on("online",function(e){userStatus!=e&&(userStatus=e,userStatusInfo={infoType:3,userStatus:""+e,user:""+user},ws.send(JSON.stringify(userStatusInfo)))}),layim.on("sign",function(e){$.ajax({type:"GET",url:"/plugin/Chat/tools/ChangeUserInfo.php",data:"user="+user+"&type=1&sign="+encodeURIComponent(e)})}),layim.on("chatChange",function(e){var a=e.data.type,t=e.data.id;"friend"===a&&(layim.setChatStatus('<span id="'+t+'InputStatus" style="color:#FF5722;display:none;">对方正在输入。。</span>'),$(".layim-chat-textarea textarea").bind("input propertychange",function(){$(this).val()?inputStatus=1:inputStatus=0,userInputInfo={infoType:4,inputStatus:inputStatus,to:""+t,from:""+user},ws.send(JSON.stringify(userInputInfo))}))}),layim.on("sendMessage",function(e){var a=e.mine,t=e.to;if("friend"==t.type||"group"==t.type){var s={infoType:2,to:""+t.id,from:""+a.id,message:""+a.content,username:""+a.username,avatar:""+a.avatar,type:""+t.type};ws.send(JSON.stringify(s))}}),ws.onmessage=function(res){var res=eval("("+res.data+")");switch(res.state){case 0:break;case 1:layim.on("ready",function(e){for(var a=0;a<res.data.length;a++)layim.getMessage(res.data[a])});break;case 2:layim.getMessage(res.data);break;case 3:"online"==res.data.type?type="online":type="offline",layim.setFriendStatus(res.data.id,type);break;case 4:var inputStatus=res.data.inputStatus,from=res.data.from;"1"==inputStatus?($("#"+from+"InputStatus").css("display","block"),showInputState&&(showInputState=!1,setTimeout(function(){$("#"+from+"InputStatus").css("display","none"),showInputState=!0},5e3))):$("#"+from+"InputStatus").css("display","none");break;case 5:case 6:case 7:newJoin++;var newMessageTips=$(".layim-tool-msgbox").find("span");newMessageTips.html(newJoin),newMessageTips.addClass("layui-anim-fadein layui-anim-loop"),newMessageTips.css("display","block");break;case 8:case 9:layim.addList(res.data);break;case 10:$(".layim-friend"+res.data.userTable).remove()}}}function showPage(){var e=layui.data("lightly").lastPage;if(e){var a=e.split("Main"),t=a[0]+a[1];changePageState(e,$("."+t))}else layui.data("lightly",{key:"lastPage",value:"courseMainPage"})}function unix2common(e){var a=new Date(1e3*e);return a.toLocaleString()}function changeClassTable(data,value,changeIndex){var classLoad=layer.open({type:3,shade:[.5,"#000000"]}),teacherName=data.teacherName,classPeriod=data.classPeriod,classContent=data.classContent,whichClass=data.whichClass,submitState=!1;switch(changeIndex){case 1:if(teacherName!=value){var submitState=!0;teacherName=value}break;case 2:if(classPeriod!=value){var submitState=!0;classPeriod=value}break;case 3:if(classContent!=value){var submitState=!0;classContent=value}}if(submitState){for(var myArr=["一","二","三","四","五","六"],i=0;i<myArr.length;i++)if(whichClass==myArr[i]){whichClass=i;break}var dataArr={whichClass:whichClass,classContent:classContent,classPeriod:classPeriod,teacherName:teacherName};$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=8&data="+JSON.stringify(dataArr)+"&accountInfo="+accountInfo,dataType:"json",success:function(data){layer.close(classLoad);var result=eval(data);1==Number(result.status)&&layer.msg("修改成功")}})}}var table=layui.table,$=layui.$,util=layui.util,element=layui.element,form=layui.form,layer=layui.layer,user=layui.data("lightly").user,switchValue=0;studyRemind=!1,null==user&&(layer.msg("未登陆"),$(function(){setTimeout(function(){$(location).attr("href","/login.html")},300)}));var accountInfo=layui.data("lightly").accountInfo.account,layim=layui.layim,initLayim=!0,userStatus="",showInputState=!0,isPC=!0,ajaxIndex=0;if(newJoin=0,"none"==$(".device-type").css("display")&&(isPC=!1,$(".container-box").css("display","block"),$(".layer-footer").css("display","block")),$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=12&user="+user,dataType:"json",success:function(res){var result=eval(res);1==Number(result.status)&&1==Number(result.data.remindState)&&0==Number(result.data.todayRemindState)&&(studyRemind=!0),3==ajaxIndex?(layer.close(allPageLoad),$(".container-box").css("display","block"),$(".layer-footer").css("display","block"),studyRemind&&layer.open({content:'<p style="text-align:center;">今天要好好学习哦!</p>',btn:["今天不再提醒"],btnAlign:"c",yes:function(e,a){layer.close(e),$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=9&user="+user})}})):ajaxIndex++}}),table.render({elem:"#classTable",height:275,url:"/plugin/GetCourse/CourseOperation.php",where:{account:accountInfo,password:accountInfo,type:1},cols:[[{field:"whichClass",title:"节次"},{field:"teacherName",title:"老师",event:"changeTeacher"},{field:"classPeriod",title:"时段",event:"changePeriod"},{field:"classContent",title:"课程",event:"changeClass"}]]}),isPC)var allPageLoad=layer.open({type:3,shade:[1,"#ffffff"]});isPC||showPage(),layui.data("lightly").headImage?($(".head-image").attr("src",layui.data("lightly").userInfo.headImage),$(".nickname").html(layui.data("lightly").userInfo.nickname),$(".stu-number").html(layui.data("lightly").userInfo.stuNumber)):$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=0&user="+user,dataType:"json",success:function(res){var result=eval(res);$(".head-image").attr("src",result.data.headImage),$(".nickname").html(result.data.nickname),$(".stu-number").html(result.data.stuNumber),1==Number(result.status)&&layui.data("lightly",{key:"userInfo",value:result.data}),3==ajaxIndex?(layer.close(allPageLoad),$(".container-box").css("display","block"),$(".layer-footer").css("display","block"),studyRemind&&layer.open({content:'<p style="text-align:center;">今天要好好学习哦!</p>',btn:["今天不再提醒"],btnAlign:"c",yes:function(e,a){layer.close(e),$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=9&user="+user})}})):ajaxIndex++}}),$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=1&user="+user,dataType:"json",success:function(data){var result=eval(data);if(1==Number(result.status)){for(var dom="",i=0;i<result.data.length;i++)dom+='<li class="layui-timeline-item"><i class="layui-icon layui-timeline-axis">&#xe63f;</i><div class="layui-timeline-content layui-text"><h3 class="layui-timeline-title">'+unix2common(result.data[i].time)+"</h3><p>"+result.data[i].content,"欢迎加入若轻"!=result.data[i].content&&(dom+="<br>获得若轻分"+result.data[i].getScore),dom+="<br>当前若轻分为 "+result.data[i].score+"</p></div></li>";dom+='<li class="layui-timeline-item"><i class="layui-icon layui-timeline-axis">&#xe63f;</i><div class="layui-timeline-content layui-text"><div class="layui-timeline-title">显示最近4条记录</div></div></li>',$(".lightly-progress").append($.parseHTML(dom))}3==ajaxIndex?(layer.close(allPageLoad),$(".container-box").css("display","block"),$(".layer-footer").css("display","block"),studyRemind&&layer.open({content:'<p style="text-align:center;">今天要好好学习哦!</p>',btn:["今天不再提醒"],btnAlign:"c",yes:function(e,a){layer.close(e),$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=9&user="+user})}})):ajaxIndex++}}),$.ajax({type:"GET",url:"/plugin/LittleFunction/Search.php",data:"type=2&user="+user,dataType:"json",success:function(data){var result=eval(data);1==Number(result.status)&&($(".score-number").html(result.data.nowScore),$(".win-number").children("span:eq(0)").html(result.data.winTimes),$(".win-number").children("span:eq(1)").html(result.data.failTimes),$(".learn-progress").html(result.data.studySubject),$(".layui-progress-bar").attr("lay-percent",result.data.studyProgress+"%"),element.render("progress")),3==ajaxIndex?(layer.close(allPageLoad),$(".container-box").css("display","block"),$(".layer-footer").css("display","block"),studyRemind&&layer.open({content:'<p style="text-align:center;">今天要好好学习哦!</p>',btn:["今天不再提醒"],btnAlign:"c",yes:function(e,a){layer.close(e),$.ajax({type:"GET",url:"/plugin/LittleFunction/Change.php",data:"type=9&user="+user})}})):ajaxIndex++}}),form.on("switch(changeClassState)",function(e){switchValue=e.elem.checked?1:0}),table.on("tool(getCourse)",function(e){var a=e.data;"changeTeacher"==e.event&&1==switchValue?layer.prompt({formType:2,title:"修改该讲老师为 :",value:a.teacherName,maxlength:50},function(t,s){layer.close(s),changeClassTable(a,t,1),e.update({teacherName:t})}):"changePeriod"==e.event&&1==switchValue?layer.prompt({formType:2,title:"修改该讲上课时段为 :",value:a.classPeriod,maxlength:50},function(t,s){layer.close(s),changeClassTable(a,t,2),e.update({classPeriod:t})}):"changeClass"==e.event&&1==switchValue&&layer.prompt({formType:2,title:"修改该讲课程为 :",value:a.classContent,maxlength:50},function(t,s){layer.close(s),changeClassTable(a,t,3),e.update({classContent:t})})}),util.event("lay-active",{learn:function(){$(location).attr("href","/res/study_now/")},packageExplore:function(){$(location).attr("href","/res/study_package/")},progress:function(){$(location).attr("href","/res/progress/")},entertainment:function(){$(location).attr("href","/res/entertainment/")},importQuestion:function(){$(location).attr("href","/res/upload_question/")},friendsGame:function(){$(location).attr("href","/res/friends_game/")},friendsStatus:function(){$(location).attr("href","/res/friends_news/")},myInfo:function(){$(location).attr("href","/res/my_info/")},findfriend:function(){layer.msg("暂只支持PC版")},settings:function(){$(location).attr("href","/res/regular_setting/")},aboutus:function(){$(location).attr("href","/res/aboutus/")},feedback:function(){$(location).attr("href","/res/feedback/")},exit:function(){layer.open({type:1,title:"提示",offset:"auto",content:'<div style="padding: 20px 100px;">期待与你下次相遇!</div>',btn:"退出账户",btnAlign:"c",shade:0,yes:function(){layer.closeAll(),layui.data("lightly",null),$(location).attr("href","/login.html")}})},coursePage:function(){layui.data("lightly",{key:"lastPage",value:"courseMainPage"}),changePageState("courseMainPage",$(this))},homePage:function(){layui.data("lightly",{key:"lastPage",value:"homeMainPage"}),changePageState("homeMainPage",$(this))},systemPage:function(){layui.data("lightly",{key:"lastPage",value:"systemMainPage"}),changePageState("systemMainPage",$(this))}}),isPC&&(initLayim=!1,ws=new WebSocket("ws://lightly.52ch.top:8686"),createLayim(ws,$,layim,layer,user,userStatus,showInputState)),$(window).resize(function(){isPC="none"!=$(".device-type").css("display"),isPC&&initLayim?(initLayim=!1,ws=new WebSocket("ws://lightly.52ch.top:8686"),createLayim(ws,$,layim,layer,user,userStatus,showInputState)):isPC||initLayim||(initLayim=!0,ws.close(),$(".layui-layer").remove())})});